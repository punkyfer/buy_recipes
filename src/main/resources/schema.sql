DROP TABLE IF EXISTS cart_recipes, cart_items, carts, recipe_products, recipes, products CASCADE;

-- Tables
CREATE TABLE products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price_in_cents INT NOT NULL
);

CREATE TABLE recipes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE carts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    total_in_cents INT NOT NULL DEFAULT 0
);

CREATE TABLE recipe_products (
    recipe_id BIGINT NOT NULL REFERENCES recipes(id),
    product_id BIGINT NOT NULL REFERENCES products(id),
    PRIMARY KEY (recipe_id, product_id)
);

CREATE TABLE cart_recipes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cart_id BIGINT NOT NULL REFERENCES carts(id),
    recipe_id BIGINT NOT NULL REFERENCES recipes(id),
    quantity INT NOT NULL DEFAULT 1,
    UNIQUE (cart_id, recipe_id)
);

CREATE TABLE cart_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cart_id BIGINT NOT NULL REFERENCES carts(id),
    product_id BIGINT NOT NULL REFERENCES products(id),
    quantity INT NOT NULL DEFAULT 1,
    UNIQUE (cart_id, product_id)
);


-- Seed Data
INSERT INTO products (id, name, price_in_cents) VALUES
(1, 'Flour', 200),
(2, 'Sugar', 150),
(3, 'Eggs', 300);

INSERT INTO recipes (id, name) VALUES
(101, 'Simple Cake'),
(102, 'Pancakes');

-- Cake: Flour, Sugar, Eggs, Butter
INSERT INTO recipe_products (recipe_id, product_id) VALUES (101, 1), (101, 2), (101, 3);
-- Pancakes: Flour, Eggs, Butter
INSERT INTO recipe_products (recipe_id, product_id) VALUES (102, 1), (102, 3);

INSERT INTO carts (id) VALUES (1);